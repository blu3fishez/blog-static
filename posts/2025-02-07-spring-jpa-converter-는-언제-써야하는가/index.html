<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>[Spring JPA] Converter 는 언제 써야하는가 | blog.moozeh</title>
<meta name="keywords" content="Spring, JPA">
<meta name="description" content="Type 을 정의하는 테이블을 정의해서 매핑하는데, Entity 와 ManyToOne을 쓰면 적절하지 않을 것 같았다.
ENUM 을 쓰면 적절하지 않을 것 같다는 의견을 검색하다가 보았고, 테이블을 정의해서 ENUM 처럼 쓰는게 좋아보일 것이라 판단했는데, Claude 로부터 @Converter 를 써보라는 추천을 받아서 알게 되었고 학습하게 되었다.

@Converter 란
@Converter 어노테이션은 일종의 컴포넌트형 어노테이션의 일종이다.
즉, 하나의 클래스에 @Converter 어노테이션에 붙여야하고, 구현해야하는 여러가지의  컨버터 interface 르 가져 각각의 Converter는 여러가지의 종류의 Converter와 느슨하게 결합되어있다.">
<meta name="author" content="moozeh">
<link rel="canonical" href="http://localhost:1313/posts/2025-02-07-spring-jpa-converter-%EB%8A%94-%EC%96%B8%EC%A0%9C-%EC%8D%A8%EC%95%BC%ED%95%98%EB%8A%94%EA%B0%80/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.580d5c4b37c6350e62c76a9e39ccff4785bf5e515b18b3cb0605dea4cc5f5376.css" integrity="sha256-WA1cSzfGNQ5ix2qeOcz/R4W/XlFbGLPLBgXepMxfU3Y=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2025-02-07-spring-jpa-converter-%EB%8A%94-%EC%96%B8%EC%A0%9C-%EC%8D%A8%EC%95%BC%ED%95%98%EB%8A%94%EA%B0%80/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/2025-02-07-spring-jpa-converter-%EB%8A%94-%EC%96%B8%EC%A0%9C-%EC%8D%A8%EC%95%BC%ED%95%98%EB%8A%94%EA%B0%80/">
  <meta property="og:site_name" content="blog.moozeh">
  <meta property="og:title" content="[Spring JPA] Converter 는 언제 써야하는가">
  <meta property="og:description" content="Type 을 정의하는 테이블을 정의해서 매핑하는데, Entity 와 ManyToOne을 쓰면 적절하지 않을 것 같았다.
ENUM 을 쓰면 적절하지 않을 것 같다는 의견을 검색하다가 보았고, 테이블을 정의해서 ENUM 처럼 쓰는게 좋아보일 것이라 판단했는데, Claude 로부터 @Converter 를 써보라는 추천을 받아서 알게 되었고 학습하게 되었다.
@Converter 란 @Converter 어노테이션은 일종의 컴포넌트형 어노테이션의 일종이다.
즉, 하나의 클래스에 @Converter 어노테이션에 붙여야하고, 구현해야하는 여러가지의 컨버터 interface 르 가져 각각의 Converter는 여러가지의 종류의 Converter와 느슨하게 결합되어있다.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-07T00:23:30+09:00">
    <meta property="article:modified_time" content="2025-02-07T00:23:30+09:00">
    <meta property="article:tag" content="Spring">
    <meta property="article:tag" content="JPA">
      <meta property="og:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:title" content="[Spring JPA] Converter 는 언제 써야하는가">
<meta name="twitter:description" content="Type 을 정의하는 테이블을 정의해서 매핑하는데, Entity 와 ManyToOne을 쓰면 적절하지 않을 것 같았다.
ENUM 을 쓰면 적절하지 않을 것 같다는 의견을 검색하다가 보았고, 테이블을 정의해서 ENUM 처럼 쓰는게 좋아보일 것이라 판단했는데, Claude 로부터 @Converter 를 써보라는 추천을 받아서 알게 되었고 학습하게 되었다.

@Converter 란
@Converter 어노테이션은 일종의 컴포넌트형 어노테이션의 일종이다.
즉, 하나의 클래스에 @Converter 어노테이션에 붙여야하고, 구현해야하는 여러가지의  컨버터 interface 르 가져 각각의 Converter는 여러가지의 종류의 Converter와 느슨하게 결합되어있다.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "[Spring JPA] Converter 는 언제 써야하는가",
      "item": "http://localhost:1313/posts/2025-02-07-spring-jpa-converter-%EB%8A%94-%EC%96%B8%EC%A0%9C-%EC%8D%A8%EC%95%BC%ED%95%98%EB%8A%94%EA%B0%80/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[Spring JPA] Converter 는 언제 써야하는가",
  "name": "[Spring JPA] Converter 는 언제 써야하는가",
  "description": "Type 을 정의하는 테이블을 정의해서 매핑하는데, Entity 와 ManyToOne을 쓰면 적절하지 않을 것 같았다.\nENUM 을 쓰면 적절하지 않을 것 같다는 의견을 검색하다가 보았고, 테이블을 정의해서 ENUM 처럼 쓰는게 좋아보일 것이라 판단했는데, Claude 로부터 @Converter 를 써보라는 추천을 받아서 알게 되었고 학습하게 되었다.\n@Converter 란 @Converter 어노테이션은 일종의 컴포넌트형 어노테이션의 일종이다.\n즉, 하나의 클래스에 @Converter 어노테이션에 붙여야하고, 구현해야하는 여러가지의 컨버터 interface 르 가져 각각의 Converter는 여러가지의 종류의 Converter와 느슨하게 결합되어있다.\n",
  "keywords": [
    "Spring", "JPA"
  ],
  "articleBody": "Type 을 정의하는 테이블을 정의해서 매핑하는데, Entity 와 ManyToOne을 쓰면 적절하지 않을 것 같았다.\nENUM 을 쓰면 적절하지 않을 것 같다는 의견을 검색하다가 보았고, 테이블을 정의해서 ENUM 처럼 쓰는게 좋아보일 것이라 판단했는데, Claude 로부터 @Converter 를 써보라는 추천을 받아서 알게 되었고 학습하게 되었다.\n@Converter 란 @Converter 어노테이션은 일종의 컴포넌트형 어노테이션의 일종이다.\n즉, 하나의 클래스에 @Converter 어노테이션에 붙여야하고, 구현해야하는 여러가지의 컨버터 interface 르 가져 각각의 Converter는 여러가지의 종류의 Converter와 느슨하게 결합되어있다.\nAttributeConverter - 가장 일반적, 커스텀 변환 로직 BaseConverter - 기본 타입 변환용 ElementConverter - 컬렉션 요소 변환 EnumConverter - enum ↔ DB 값 변환 일반적인 @Converter 구현 가장 일반적인 AttributeConverter 에 대해 알아보자.\n앞서 언급된 Type 테이블로부터 특정 타입인지 하나의 엔티티에서 바로 조회를 해서 확인하고 싶은 경우가 있다.\n@Enumerated 를 사용할 수도 있겠지만, 데이터베이스 구현 상 별도의 타입을 정의한 테이블에서 관리할 경우, 위와 같이 @Converter 를 사용해서 자연스럽게 매핑할 수도 있다.\n@Entity @Table(name = \"reaction_type\") public class ReactionType { @Id @Column(name = \"react_code\") private String code; } @Entity @Table(name = \"reactions\") public class Reaction { @Id private Long id; @Column(name = \"board_id\") private Long boardId; @Column(name = \"account_id\") private Long accountId; @Convert(converter = ReactionTypeConverter.class) @Column(name = \"react_code\") private ReactionType type; @Column(name = \"deleted\") private boolean deleted; } @Converter public class ReactionTypeConverter implements AttributeConverter\u003cReactionType, String\u003e { @Autowired private ReactionTypeRepository typeRepository; @Override public String convertToDatabaseColumn(ReactionType type) { return type.getCode(); } @Override public TypeEntity convertToEntityAttribute(String code) { return typeRepository.findById(code).orElseThrow(); } } 코드 설명 convertToDatabaseColumn 은 database에 저장할때, convertToEntityAttribute 는 JPA 엔티티로부터 getter 등으로 불러올때 호출되어 리턴되는 값이 반영된다.\nconvertToDatabaseColumn: 엔티티 → DB 저장 시 호출 convertToEntityAttribute: DB → 엔티티 조회 시 호출 (getter 포함) @Converter 의 특징 보통은 일반적인 커스텀 변환 로직이 추가 되기 때문에 엔티티로부터 불러올때 특별한 처리가 필요한 경우에 사용하면 유용하며다.\n하지만, 그런 변환 로직들은 대개 Entity 의 책임 내에서 처리하게 되므로 하나의 Entity의 영역에서 벗어나 공통적인 변환을 위한 변환 계층이 필요할때 사용하게 된다.\n여러 엔티티에서 재사용 가능 특정 타입/값의 일관된 변환 로직 제공 DB 컬럼과 Java 객체 간의 공통 변환 규칙 정의 즉 위와 같은 상황에서만 유용하며, 그 외의 경우에는 다른 방식을 써보는 것을 추천한다.\n왜 써야할까? 그래서 꼭 써야하는 이유에 대한 궁금증이 많았다.\n다른 대안들의 단점 쓸 수 있는 이유로 아래와 같은 대안의 단점이 있었다.\nManyToOne 의 단점\n항상 JOIN이 발생 N+1 문제 가능성 영속성 컨텍스트 관리 필요 Converter 의 장점\nJOIN 없이 직접 값 매핑 단순 코드 참조 시 더 효율적 영속성 컨텍스트 부담 감소 하지만 실제로는 단순한 Type Table 의 경우 ManyToOne이 더 효율적이고 간단하다.\n그래서 실제로 일반적인 대부분의 상황에서는 ManyToOne을 사용한다.\n@Converter 를 사용할 때 : 테이블 캐싱 하지만 ManyToOne 은 매번 조회시 JOIN 이 일어나게 되므로 성능저하가 일어난다.\n따라서, 이런 경우 캐싱을 적용한다. 캐싱은 신이야..\n즉, 타입 테이블을 미리 메모리에 올려서 메모리 내에서 JOIN을 시키는 것이다…!\n어차피 타입 테이블의 경우 크게 추가되지 않는 경우가 대부분이기 때문에 변화될 일이 적기 때문에 메모리에 올려도 괜찮다고 판단될 경우 올려버릴 수 있는 것이다..!\n@Service public class ReactionTypeCache { private Map\u003cString, ReactionType\u003e cache; @PostConstruct public void init() { cache = reactionTypeRepository.findAll() .stream() .collect(toMap(ReactionType::getCode, type -\u003e type)); } public ReactionType getType(String code) { return cache.get(code); } } 이렇게 별도의 캐시를 두고, 이 Cache 를 Converter 에서 넣어서 사용해볼 수도 있을 것이다!\n그렇게 되면 DB 조회 횟수도 감소되고, 그에 따라 응답시간도 개선될 수 있을 것이다.\n2nd Level cache 이런 종류를 Second Level Cache 라고 부르며, 대개 애플리케이션 수준에서 일어나는 캐싱을 뜻한다.\n왜냐하면 이러한 캐시는 하나의 트랜잭션 범위가 아니기 때문에 영속성 컨텍스트 단위가 아니며, 여러 트랜잭션을 아우르는 정보를 캐싱하기 때문이다.\n결론적으로 캐싱이 필요한 정말로 극한의 상황이 아니라면 자주 쓰진 않을 것 같다…\n",
  "wordCount" : "569",
  "inLanguage": "en",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2025-02-07T00:23:30+09:00",
  "dateModified": "2025-02-07T00:23:30+09:00",
  "author":{
    "@type": "Person",
    "name": "moozeh"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/2025-02-07-spring-jpa-converter-%EB%8A%94-%EC%96%B8%EC%A0%9C-%EC%8D%A8%EC%95%BC%ED%95%98%EB%8A%94%EA%B0%80/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "blog.moozeh",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="blog.moozeh (Alt + H)">blog.moozeh</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      [Spring JPA] Converter 는 언제 써야하는가
    </h1>
    <div class="post-meta"><span title='2025-02-07 00:23:30 +0900 KST'>February 7, 2025</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;moozeh

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#converter-%eb%9e%80" aria-label="@Converter 란">@Converter 란</a><ul>
                        
                <li>
                    <a href="#%ec%9d%bc%eb%b0%98%ec%a0%81%ec%9d%b8-converter-%ea%b5%ac%ed%98%84" aria-label="일반적인 @Converter 구현">일반적인 @Converter 구현</a></li>
                <li>
                    <a href="#%ec%bd%94%eb%93%9c-%ec%84%a4%eb%aa%85" aria-label="코드 설명">코드 설명</a></li>
                <li>
                    <a href="#converter-%ec%9d%98-%ed%8a%b9%ec%a7%95" aria-label="@Converter 의 특징">@Converter 의 특징</a></li></ul>
                </li>
                <li>
                    <a href="#%ec%99%9c-%ec%8d%a8%ec%95%bc%ed%95%a0%ea%b9%8c" aria-label="왜 써야할까?">왜 써야할까?</a><ul>
                        
                <li>
                    <a href="#%eb%8b%a4%eb%a5%b8-%eb%8c%80%ec%95%88%eb%93%a4%ec%9d%98-%eb%8b%a8%ec%a0%90" aria-label="다른 대안들의 단점">다른 대안들의 단점</a></li>
                <li>
                    <a href="#converter-%eb%a5%bc-%ec%82%ac%ec%9a%a9%ed%95%a0-%eb%95%8c--%ed%85%8c%ec%9d%b4%eb%b8%94-%ec%ba%90%ec%8b%b1" aria-label="@Converter 를 사용할 때 : 테이블 캐싱">@Converter 를 사용할 때 : 테이블 캐싱</a></li>
                <li>
                    <a href="#2nd-level-cache" aria-label="2nd Level cache">2nd Level cache</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>
<div class="post-content"><p><code>Type</code> 을 정의하는 테이블을 정의해서 매핑하는데, Entity 와 ManyToOne을 쓰면 적절하지 않을 것 같았다.</p>
<p>ENUM 을 쓰면 적절하지 않을 것 같다는 의견을 검색하다가 보았고, 테이블을 정의해서 ENUM 처럼 쓰는게 좋아보일 것이라 판단했는데, <code>Claude</code> 로부터 <code>@Converter</code> 를 써보라는 추천을 받아서 알게 되었고 학습하게 되었다.</p>
<!-- more -->
<h2 id="converter-란">@Converter 란<a hidden class="anchor" aria-hidden="true" href="#converter-란">#</a></h2>
<p><code>@Converter</code> 어노테이션은 일종의 컴포넌트형 어노테이션의 일종이다.</p>
<p>즉, 하나의 클래스에 <code>@Converter</code> 어노테이션에 붙여야하고, 구현해야하는 여러가지의  컨버터 <code>interface</code> 르 가져 각각의 <code>Converter</code>는 여러가지의 종류의 Converter와 느슨하게 결합되어있다.</p>
<ul>
<li>AttributeConverter - 가장 일반적, 커스텀 변환 로직</li>
<li>BaseConverter - 기본 타입 변환용</li>
<li>ElementConverter - 컬렉션 요소 변환</li>
<li>EnumConverter - enum ↔ DB 값 변환</li>
</ul>
<h3 id="일반적인-converter-구현">일반적인 @Converter 구현<a hidden class="anchor" aria-hidden="true" href="#일반적인-converter-구현">#</a></h3>
<p>가장 일반적인 <code>AttributeConverter</code> 에 대해 알아보자.</p>
<p>앞서 언급된 <code>Type</code> 테이블로부터 특정 타입인지 하나의 엔티티에서 바로 조회를 해서 확인하고 싶은 경우가 있다.</p>
<p><code>@Enumerated</code> 를 사용할 수도 있겠지만, 데이터베이스 구현 상 별도의 타입을 정의한 테이블에서 관리할 경우, 위와 같이 <code>@Converter</code> 를 사용해서 자연스럽게 매핑할 수도 있다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Entity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;reaction_type&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReactionType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;react_code&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Entity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;reactions&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Reaction</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;board_id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">boardId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;account_id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">accountId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Convert</span><span class="p">(</span><span class="n">converter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReactionTypeConverter</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;react_code&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ReactionType</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;deleted&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">deleted</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Converter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReactionTypeConverter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AttributeConverter</span><span class="o">&lt;</span><span class="n">ReactionType</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ReactionTypeRepository</span><span class="w"> </span><span class="n">typeRepository</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">convertToDatabaseColumn</span><span class="p">(</span><span class="n">ReactionType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="na">getCode</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TypeEntity</span><span class="w"> </span><span class="nf">convertToEntityAttribute</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">typeRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">code</span><span class="p">).</span><span class="na">orElseThrow</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="코드-설명">코드 설명<a hidden class="anchor" aria-hidden="true" href="#코드-설명">#</a></h3>
<p><code>convertToDatabaseColumn</code> 은 database에 저장할때,  <code>convertToEntityAttribute</code> 는 JPA 엔티티로부터 getter 등으로 불러올때 호출되어 리턴되는 값이 반영된다.</p>
<ul>
<li>convertToDatabaseColumn: 엔티티 → DB 저장 시 호출</li>
<li>convertToEntityAttribute: DB → 엔티티 조회 시 호출 (getter 포함)</li>
</ul>
<h3 id="converter-의-특징">@Converter 의 특징<a hidden class="anchor" aria-hidden="true" href="#converter-의-특징">#</a></h3>
<p>보통은 일반적인 커스텀 변환 <strong>로직</strong>이 추가 되기 때문에 엔티티로부터 불러올때 특별한 처리가 필요한 경우에 사용하면 유용하며다.</p>
<p>하지만, 그런 변환 로직들은 대개 <code>Entity</code> 의 책임 내에서 처리하게 되므로 하나의 Entity의 영역에서 벗어나 공통적인 변환을 위한 변환 계층이 필요할때 사용하게 된다.</p>
<ul>
<li>여러 엔티티에서 재사용 가능</li>
<li>특정 타입/값의 일관된 변환 로직 제공</li>
<li>DB 컬럼과 Java 객체 간의 공통 변환 규칙 정의</li>
</ul>
<p>즉 위와 같은 상황에서만 유용하며, 그 외의 경우에는 다른 방식을 써보는 것을 추천한다.</p>
<h2 id="왜-써야할까">왜 써야할까?<a hidden class="anchor" aria-hidden="true" href="#왜-써야할까">#</a></h2>
<p>그래서 꼭 써야하는 이유에 대한 궁금증이 많았다.</p>
<h3 id="다른-대안들의-단점">다른 대안들의 단점<a hidden class="anchor" aria-hidden="true" href="#다른-대안들의-단점">#</a></h3>
<p>쓸 수 있는 이유로 아래와 같은 대안의 단점이 있었다.</p>
<blockquote>
<p>ManyToOne 의 단점</p></blockquote>
<ul>
<li>항상 JOIN이 발생</li>
<li>N+1 문제 가능성</li>
<li>영속성 컨텍스트 관리 필요</li>
</ul>
<blockquote>
<p>Converter 의 장점</p></blockquote>
<ul>
<li>JOIN 없이 직접 값 매핑</li>
<li>단순 코드 참조 시 더 효율적</li>
<li>영속성 컨텍스트 부담 감소</li>
</ul>
<p>하지만 실제로는 단순한 <code>Type Table</code> 의 경우 <code>ManyToOne</code>이 더 효율적이고 간단하다.</p>
<p>그래서 실제로 <strong>일반적인 대부분의 상황에서는 ManyToOne을 사용한다.</strong></p>
<h3 id="converter-를-사용할-때--테이블-캐싱">@Converter 를 사용할 때 : 테이블 캐싱<a hidden class="anchor" aria-hidden="true" href="#converter-를-사용할-때--테이블-캐싱">#</a></h3>
<p>하지만 <code>ManyToOne</code> 은 매번 조회시 <code>JOIN</code> 이 일어나게 되므로 성능저하가 일어난다.</p>
<p>따라서, 이런 경우 캐싱을 적용한다. <del>캐싱은 신이야..</del></p>
<p>즉, 타입 테이블을 미리 메모리에 올려서 메모리 내에서 JOIN을 시키는 것이다&hellip;!</p>
<p>어차피 타입 테이블의 경우 크게 추가되지 않는 경우가 대부분이기 때문에 변화될 일이 적기 때문에 메모리에 올려도 괜찮다고 판단될 경우 올려버릴 수 있는 것이다..!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReactionTypeCache</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">ReactionType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostConstruct</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reactionTypeRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">toMap</span><span class="p">(</span><span class="n">ReactionType</span><span class="p">::</span><span class="n">getCode</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">type</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ReactionType</span><span class="w"> </span><span class="nf">getType</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">code</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>이렇게 별도의 캐시를 두고, 이 <code>Cache</code> 를 Converter 에서 넣어서 사용해볼 수도 있을 것이다!</p>
<p>그렇게 되면 <code>DB 조회</code> 횟수도 감소되고, 그에 따라 응답시간도 개선될 수 있을 것이다.</p>
<h3 id="2nd-level-cache">2nd Level cache<a hidden class="anchor" aria-hidden="true" href="#2nd-level-cache">#</a></h3>
<p>이런 종류를 <code>Second Level Cache</code> 라고 부르며, 대개 <strong>애플리케이션 수준에서 일어나는 캐싱</strong>을 뜻한다.</p>
<p>왜냐하면 이러한 캐시는 <code>하나의 트랜잭션 범위</code>가 아니기 때문에 영속성 컨텍스트 단위가 아니며, 여러 트랜잭션을 아우르는 정보를 캐싱하기 때문이다.</p>
<p>결론적으로 캐싱이 필요한 정말로 극한의 상황이 아니라면 자주 쓰진 않을 것 같다&hellip;</p>


    </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/spring/">Spring</a></li>
      <li><a href="http://localhost:1313/tags/jpa/">JPA</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/2025-02-16-spring-jpa-embeddable-%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%B3%B5%ED%95%A9-pk-%ED%82%A4-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0/">
    <span class="title">« Prev</span>
    <br>
    <span>[Spring JPA] @Embeddable 을 이용한 복합 PK 키 설정하기</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/2025-02-04-spring-jpa-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%83%81%EC%86%8D%EC%97%90-%EA%B4%80%ED%95%98%EC%97%AC/">
    <span class="title">Next »</span>
    <br>
    <span>[Spring JPA] 테이블 상속에 관하여</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>© <a href="https://github.com/moozeh">moozeh</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
