<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>도커 네트워크 인터페이스를 알아보자 | blog.blu3fishez</title>
<meta name="keywords" content="network">

<meta name="description" content="❕ 문제 상황 Nest.js 를 배우다가 데이터베이스를 사용할 일이 생겼다.
보통 나는 환경이 분리되는 걸 선호한다. 그래서 전역적으로 설치되는걸 좋아하지 않는다. pip 같은 것들 말이다.
그래서 찾아보니, Docker 위에 MySQL 컨테이너를 올려서 사용하면 환경 분리가 된다고 하더라.
도커와 관련해서는 CLI 환경에서 결국엔 다루는게 맞다고 생각했다. 그런데, 일단은 도커가 처음이기에 아직 내가 많이 몰라서 Docker Desktop 을 이용해서 문제를 해결하려고 한다.
MySQL 에 접속이 안되는 문제 mysql -u root -p&#39;root&#39; -h 172.17.0.2 mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2003 (HY000): Can&#39;t connect to MySQL server on &#39;172.17.0.2:3306&#39; (60) 위와 같이, root 계정으로 직접적으로 접속하려고 했었다. 그런데, mysql 클라이언트 단에서 서버로 연결을 하지 못하는 상황이었다.
">
<meta name="author" content="blu3fishez">
<link rel="canonical" href="https://blog.blu3fishez.org/posts/2024/2024-10-26-%EB%8F%84%EC%BB%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d3f251795b1b2227fec87dbd9339a39a72025c1e2678c7b78fdbf5213fbef45d.css" integrity="sha256-0/JReVsbIif&#43;yH29kzmjmnICXB4meMe3j9v1IT&#43;&#43;9F0=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.blu3fishez.org/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.blu3fishez.org/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.blu3fishez.org/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.blu3fishez.org/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.blu3fishez.org/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://blog.blu3fishez.org/posts/2024/2024-10-26-%EB%8F%84%EC%BB%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://blog.blu3fishez.org/posts/2024/2024-10-26-%EB%8F%84%EC%BB%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90/">
  <meta property="og:site_name" content="blog.blu3fishez">
  <meta property="og:title" content="도커 네트워크 인터페이스를 알아보자">
  <meta property="og:description" content="❕ 문제 상황 Nest.js 를 배우다가 데이터베이스를 사용할 일이 생겼다.
보통 나는 환경이 분리되는 걸 선호한다. 그래서 전역적으로 설치되는걸 좋아하지 않는다. pip 같은 것들 말이다.
그래서 찾아보니, Docker 위에 MySQL 컨테이너를 올려서 사용하면 환경 분리가 된다고 하더라.
도커와 관련해서는 CLI 환경에서 결국엔 다루는게 맞다고 생각했다. 그런데, 일단은 도커가 처음이기에 아직 내가 많이 몰라서 Docker Desktop 을 이용해서 문제를 해결하려고 한다.
MySQL 에 접속이 안되는 문제 mysql -u root -p&#39;root&#39; -h 172.17.0.2 mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2003 (HY000): Can&#39;t connect to MySQL server on &#39;172.17.0.2:3306&#39; (60) 위와 같이, root 계정으로 직접적으로 접속하려고 했었다. 그런데, mysql 클라이언트 단에서 서버로 연결을 하지 못하는 상황이었다.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-10-26T14:58:10+09:00">
    <meta property="article:modified_time" content="2024-10-26T14:58:10+09:00">
    <meta property="article:tag" content="Network">
      <meta property="og:image" content="https://blog.blu3fishez.org/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.blu3fishez.org/images/papermod-cover.png">
<meta name="twitter:title" content="도커 네트워크 인터페이스를 알아보자">
<meta name="twitter:description" content="❕ 문제 상황
Nest.js 를 배우다가 데이터베이스를 사용할 일이 생겼다.
보통 나는 환경이 분리되는 걸 선호한다. 그래서 전역적으로 설치되는걸 좋아하지 않는다. pip 같은 것들 말이다.
그래서 찾아보니, Docker 위에 MySQL 컨테이너를 올려서 사용하면 환경 분리가 된다고 하더라.
![[2024-10-26-network-127001-과-localhost-의-차이-20241026161720760.webp|428]]
도커와 관련해서는 CLI 환경에서 결국엔 다루는게 맞다고 생각했다. 그런데, 일단은 도커가 처음이기에 아직 내가 많이 몰라서 Docker Desktop 을 이용해서 문제를 해결하려고 한다.
MySQL 에 접속이 안되는 문제
mysql -u root -p&#39;root&#39; -h 172.17.0.2
mysql: [Warning] Using a password on the command line interface can be insecure.
ERROR 2003 (HY000): Can&#39;t connect to MySQL server on &#39;172.17.0.2:3306&#39; (60)
위와 같이, root 계정으로 직접적으로 접속하려고 했었다. 그런데, mysql 클라이언트 단에서 서버로 연결을 하지 못하는 상황이었다.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.blu3fishez.org/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "도커 네트워크 인터페이스를 알아보자",
      "item": "https://blog.blu3fishez.org/posts/2024/2024-10-26-%EB%8F%84%EC%BB%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "도커 네트워크 인터페이스를 알아보자",
  "name": "도커 네트워크 인터페이스를 알아보자",
  "description": "❕ 문제 상황 Nest.js 를 배우다가 데이터베이스를 사용할 일이 생겼다.\n보통 나는 환경이 분리되는 걸 선호한다. 그래서 전역적으로 설치되는걸 좋아하지 않는다. pip 같은 것들 말이다.\n그래서 찾아보니, Docker 위에 MySQL 컨테이너를 올려서 사용하면 환경 분리가 된다고 하더라.\n![[2024-10-26-network-127001-과-localhost-의-차이-20241026161720760.webp|428]]\n도커와 관련해서는 CLI 환경에서 결국엔 다루는게 맞다고 생각했다. 그런데, 일단은 도커가 처음이기에 아직 내가 많이 몰라서 Docker Desktop 을 이용해서 문제를 해결하려고 한다.\nMySQL 에 접속이 안되는 문제 mysql -u root -p\u0026#39;root\u0026#39; -h 172.17.0.2 mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2003 (HY000): Can\u0026#39;t connect to MySQL server on \u0026#39;172.17.0.2:3306\u0026#39; (60) 위와 같이, root 계정으로 직접적으로 접속하려고 했었다. 그런데, mysql 클라이언트 단에서 서버로 연결을 하지 못하는 상황이었다.\n",
  "keywords": [
    "network"
  ],
  "articleBody": "❕ 문제 상황 Nest.js 를 배우다가 데이터베이스를 사용할 일이 생겼다.\n보통 나는 환경이 분리되는 걸 선호한다. 그래서 전역적으로 설치되는걸 좋아하지 않는다. pip 같은 것들 말이다.\n그래서 찾아보니, Docker 위에 MySQL 컨테이너를 올려서 사용하면 환경 분리가 된다고 하더라.\n![[2024-10-26-network-127001-과-localhost-의-차이-20241026161720760.webp|428]]\n도커와 관련해서는 CLI 환경에서 결국엔 다루는게 맞다고 생각했다. 그런데, 일단은 도커가 처음이기에 아직 내가 많이 몰라서 Docker Desktop 을 이용해서 문제를 해결하려고 한다.\nMySQL 에 접속이 안되는 문제 mysql -u root -p'root' -h 172.17.0.2 mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2003 (HY000): Can't connect to MySQL server on '172.17.0.2:3306' (60) 위와 같이, root 계정으로 직접적으로 접속하려고 했었다. 그런데, mysql 클라이언트 단에서 서버로 연결을 하지 못하는 상황이었다.\n172.17.0.2 IP 는 inspect 해서 나온 도커 컨테이너가 할당 받은 IP 이다.\n해당 IP로 연결을 시도해봤는데 연결되지 않는다고 떴다.\n🖋️ 해결 과정 결론적으로는, 아래와 같은 명령어를 써서 해결했다.\n첫번째로, 도커의 컨테이너를 외부에서 접속하게 될 때에는 내 자신의 IP로 접속해야한다.\nmysql -u root -p -h localhost -P 3306 그런데, 그 과정에서 아래와 같은 에러가 떴다.\nERROR 2002 (HY000): Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2) 한번 더 알아보니, localhost 대신에 127.0.0.1 로 호스트를 바꾸니 접속이 되었다.\n🐳 도커와 도커 엔진을 돌리는 컴퓨터가 IP 할당을 받는 방식 그렇다면 왜 컨테이너 IP로 접속을 못하고, localhost 로 접속을 해야할까?\n이것을 알려면 도커의 네트워크 구조를 알아야한다.\n도커 네트워크 구조 도커는 기본적으로 브릿지 네트워크 를 사용하여 호스트 - 컨테이너 간 통신을 관리한다.\n브릿지 네트워크란?\n브리지 네트워크는 데이터 링크 계층(Layer 2)에서 작동하는 네트워크 연결 방식 중 하나입니다. 서로 다른 네트워크 세그먼트를 하나의 논리적 네트워크로 연결하는 기술입니다.\n세그먼트 내에서 통신을 할 때에는 노드 간 직접 통신이 가능합니다.\n세그먼트 외부에서 통신을 할 때에는 브릿지를 통해 통신이 가능합니다.\n이 때 중요한건 세그먼트 외부 간 통신을 직접할 수 있도록 노드 간 직접 통신이 가능하다는 점입니다.\n이때, 도커는 호스트 컴퓨터와 소통할 수 있도록 docker0 브릿지를 설치해줍니다. 해당 브릿지를 통해서 호스트 컴퓨터는 도커 컨테이너와 통신할 수 있게 된다.\n![[2024-10-26-network-127001-과-localhost-의-차이-20241026195155071.webp]] 도커의 기본적인 네트워크 인터페이스\n도커가 생성한 가상 브릿지 docker0 와 커스텀 브릿지 도커는 컨테이너와 호스트, 나아가서 외부 인터넷과 통신하기 위해서 docker0 라는 이름의 가상 브릿지를 생성한다.\n해당 브릿지는 호스트 컴퓨터 내에서 생성 되며, 각 컨테이너는 eth0 라는 네트워크 인터페이스를 통해 docker0 브릿지와 연결된다. 이때, veth* 라는 이름으로 docker0 브릿지에서 네트워크 인터페이스로 연결된다.\n또한, 별도의 커스텀 브릿지도 생성할 수 있다.\n아래와 같이 br- 로 시작하는 경우 컨테이너에서 직접 외부로 통신하기 위한 커스텀 브릿지 다.\n29: br-925c9621d01a: mtu 1500 qdisc noqueue state UP group default inet 172.34.0.1/16 brd 172.34.255.255 scope global br-925c9621d01a ~ 162: vetha37a37a@if161: mtu 1500 qdisc noqueue master br-925c9621d01a state UP group default ~ 164: veth27db687@if163: mtu 1500 qdisc noqueue master br-925c9621d01a state UP group default 컨테이너 내부IP 로 접속할 수 없는 이유 컨테이너 내부의 IP (172.17.x.x/16) 는 격리된 공간 내에 존재하기 때문 그래서 외부에서는 docker0 브릿지를 통해 접근이 가능하다. ❔ 도커 브릿지로 직접 접속 할 수는 없나요?\n직접 연결 시도도 가능합니다.\n단, 아래에서 설명할 예정이지만, docker0 브릿지는 리눅스 환경에서만 확인 가능합니다.\n![[2024-10-26-network-127001-과-localhost-의-차이-20241026194313111.webp]]\nMac/Windows 에서의 Docker docker0 라는 브릿지는 Mac/Windows 옵션에서는 존재하지 않는다. 맥과 윈도우 환경에서는 별도의 가상 리눅스 위에서 설치되기 때문이다.\n따라서 맥, 윈도우 환경에서 접속하려면 해당 브릿지로 접속하려면 172.17.0.1 이 아니라 루프백 IP 를 통해서 docker0 인터페이스를 찾아서 접근하도록 해야한다.\n만약 이미 호스트 컴퓨터에서 포트가 열려있으면 어떻게 될까? 컨테이너 내부 의 포트는 호스트 포트와 독립적 으로 작동한다!\n‘3307:3306’ -\u003e ‘host - docker0 : 3307’ , ‘veth - eth : 3306’\n포트를 지정할 때 docker0 브릿지에서 매핑을 해주기 때문에, 컨테이너에서는 어떤 포트로 열더라도, 자유롭게 열어도 상관없다.\n앞서 말한대로 따로 임의로 지정하지 않으면, 컨테이너 내부에서만 열리게 된다. 이렇게 되면 포트를 컨테이너 외부로 열고 싶지 않을 때 유용하겠죠?\n정리하면 아래와 같다.\n호스트에서 3306 포트를 사용 중이더라도 컨테이너 내부에서 3306 포트를 사용할 수 있다. 포트 충돌은 호스트 포트를 컨테이너 포트에 매핑할 때만 발생한다. docker run -p 3307:3306 mysql 도커에서 실제로 실행할때, 3307 포트와 같이 외부로 매핑될 포트를 지정해주는 작업이 일어날 때 docker0 브릿지 테이블에서 수정이 일어난다.\n🤔 127.0.0.1 과 localhost 의 차이 그렇다면, 왜 172.17.x.x 포트로 연결이 안되었는지 이해가 됐을 것이다.\n172.17.x.x IP는 컨테이너 내부와 도커 브릿지 사이에 연결된 연결 정보임 맥/윈도우 도커 환경에서는 별도의 VM 위에서 돌아가기 때문에 172.17.0.1 로 직접 접속할 수 없음 하지만 그렇다고 문제가 해결되진 않았는데, localhost 를 통해서 접속했을 때는 접속이 되지 않았다.\n결국 해결했던 방법은 127.0.0.1 로 접속을 하니 문제가 해결되었다.\n![[2024-10-26-network-127001-과-localhost-의-차이-20241026200049342.webp|602]]\n일반적으로 localhost 란 도메인은 존재하지 않는다.\n모든 네트워크 요청시, DNS 라는 곳에서 도메인 이름을 통해 IP 를 알아내기 때문이다. 지원되는 IP 형식이 아니면 DNS 를 통해 IP를 찾아서 해당 IP를 통해 연결되도록 만든다.\n그 원인은 두가지에 있었는데, 도커의 IPv6 지원과 /etc/hosts 파일의 영향 때문이었다.\n/etc/hosts 파일을 통해 localhost 라는 DNS가 어떤 IP를 나타내는지 컴퓨터에 바로 알려줄 수 있도록할 수 있다. 일종의 로컬 DNS? 와 같은 느낌.\n실제로 나와같은 경우 아래처럼 IPv6, IPv4 로컬 호스트 주소를 모두 표현하도록 연결되었는데, IPv6 로 연결이 시도 되어서 이런 문제가 생겼다.\n![[2024-10-26-network-127001-과-localhost-의-차이-20241026202656011.webp]]\n도커에서 IPv6 지원 설정 활성화 도커 데스크탑 기준으로 설명\nDocker Desktop 실행 상단 메뉴의 설정(Settings) 아이콘 클릭 Docker Engine 섹션으로 이동 설정 JSON에 위의 설정을 추가 Apply \u0026 Restart 클릭 { \"ipv6\": true, \"fixed-cidr-v6\": \"2001:db8:1::/64\", \"ip6tables\": true } ![[2024-10-26-network-127001-과-localhost-의-차이-20241026203002567.webp|618]]\n이후 제대로 매핑된 걸 확인하려면 아래 명령어를 실행해주자.\ndocker network ls MySQL 에서의 localhost 특수처리 IPv6 옵션을 활성화 해도 제대로 해결할 수 없었는데, 그 이유는 mysql 만이 가지는 로컬 호스트에 대한 특수 처리 때문이었다.\nMySQL은 localhost로 접속 시 TCP/IP가 아닌 Unix 소켓 파일을 사용한다. 따라서, 도커 컨테이너의 MySQL은 호스트와 다른 환경에서 실행되므로 소켓 파일에 접근할 수 없다.\nMySQL 에서 접속할 때는 그냥 맘놓고 127.0.0.1로 접속하자…!\n",
  "wordCount" : "881",
  "inLanguage": "en",
  "image": "https://blog.blu3fishez.org/images/papermod-cover.png","datePublished": "2024-10-26T14:58:10+09:00",
  "dateModified": "2024-10-26T14:58:10+09:00",
  "author":{
    "@type": "Person",
    "name": "blu3fishez"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.blu3fishez.org/posts/2024/2024-10-26-%EB%8F%84%EC%BB%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "blog.blu3fishez",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.blu3fishez.org/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.blu3fishez.org/" accesskey="h" title="blog.blu3fishez (Alt + H)">blog.blu3fishez</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.blu3fishez.org/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://blog.blu3fishez.org/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://blog.blu3fishez.org/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.blu3fishez.org/">Home</a>&nbsp;»&nbsp;<a href="https://blog.blu3fishez.org/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      도커 네트워크 인터페이스를 알아보자
    </h1>
    <div class="post-meta"><span title='2024-10-26 14:58:10 +0900 KST'>October 26, 2024</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;blu3fishez

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#-%eb%ac%b8%ec%a0%9c-%ec%83%81%ed%99%a9" aria-label="❕ 문제 상황">❕ 문제 상황</a><ul>
                        
                <li>
                    <a href="#mysql-%ec%97%90-%ec%a0%91%ec%86%8d%ec%9d%b4-%ec%95%88%eb%90%98%eb%8a%94-%eb%ac%b8%ec%a0%9c" aria-label="MySQL 에 접속이 안되는 문제">MySQL 에 접속이 안되는 문제</a></li></ul>
                </li>
                <li>
                    <a href="#-%ed%95%b4%ea%b2%b0-%ea%b3%bc%ec%a0%95" aria-label="🖋️ 해결 과정">🖋️ 해결 과정</a></li>
                <li>
                    <a href="#-%eb%8f%84%ec%bb%a4%ec%99%80-%eb%8f%84%ec%bb%a4-%ec%97%94%ec%a7%84%ec%9d%84-%eb%8f%8c%eb%a6%ac%eb%8a%94-%ec%bb%b4%ed%93%a8%ed%84%b0%ea%b0%80-ip-%ed%95%a0%eb%8b%b9%ec%9d%84-%eb%b0%9b%eb%8a%94-%eb%b0%a9%ec%8b%9d" aria-label="🐳 도커와 도커 엔진을 돌리는 컴퓨터가 IP 할당을 받는 방식">🐳 도커와 도커 엔진을 돌리는 컴퓨터가 IP 할당을 받는 방식</a><ul>
                        
                <li>
                    <a href="#%eb%8f%84%ec%bb%a4-%eb%84%a4%ed%8a%b8%ec%9b%8c%ed%81%ac-%ea%b5%ac%ec%a1%b0" aria-label="도커 네트워크 구조">도커 네트워크 구조</a></li>
                <li>
                    <a href="#%eb%8f%84%ec%bb%a4%ea%b0%80-%ec%83%9d%ec%84%b1%ed%95%9c-%ea%b0%80%ec%83%81-%eb%b8%8c%eb%a6%bf%ec%a7%80-docker0-%ec%99%80-%ec%bb%a4%ec%8a%a4%ed%85%80-%eb%b8%8c%eb%a6%bf%ec%a7%80" aria-label="도커가 생성한 가상 브릿지 docker0 와 커스텀 브릿지">도커가 생성한 가상 브릿지 docker0 와 커스텀 브릿지</a><ul>
                        
                <li>
                    <a href="#%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88-%eb%82%b4%eb%b6%80ip-%eb%a1%9c-%ec%a0%91%ec%86%8d%ed%95%a0-%ec%88%98-%ec%97%86%eb%8a%94-%ec%9d%b4%ec%9c%a0" aria-label="컨테이너 내부IP 로 접속할 수 없는 이유">컨테이너 내부IP 로 접속할 수 없는 이유</a></li></ul>
                </li>
                <li>
                    <a href="#macwindows-%ec%97%90%ec%84%9c%ec%9d%98-docker" aria-label="Mac/Windows 에서의 Docker">Mac/Windows 에서의 Docker</a></li>
                <li>
                    <a href="#%eb%a7%8c%ec%95%bd-%ec%9d%b4%eb%af%b8-%ed%98%b8%ec%8a%a4%ed%8a%b8-%ec%bb%b4%ed%93%a8%ed%84%b0%ec%97%90%ec%84%9c-%ed%8f%ac%ed%8a%b8%ea%b0%80-%ec%97%b4%eb%a0%a4%ec%9e%88%ec%9c%bc%eb%a9%b4-%ec%96%b4%eb%96%bb%ea%b2%8c-%eb%90%a0%ea%b9%8c" aria-label="만약 이미 호스트 컴퓨터에서 포트가 열려있으면 어떻게 될까?">만약 이미 호스트 컴퓨터에서 포트가 열려있으면 어떻게 될까?</a></li></ul>
                </li>
                <li>
                    <a href="#-127001-%ea%b3%bc-localhost-%ec%9d%98-%ec%b0%a8%ec%9d%b4" aria-label="🤔 127.0.0.1 과 localhost 의 차이">🤔 127.0.0.1 과 localhost 의 차이</a><ul>
                        
                <li>
                    <a href="#%eb%8f%84%ec%bb%a4%ec%97%90%ec%84%9c-ipv6-%ec%a7%80%ec%9b%90-%ec%84%a4%ec%a0%95-%ed%99%9c%ec%84%b1%ed%99%94" aria-label="도커에서 IPv6 지원 설정 활성화">도커에서 IPv6 지원 설정 활성화</a></li></ul>
                </li>
                <li>
                    <a href="#mysql-%ec%97%90%ec%84%9c%ec%9d%98-localhost-%ed%8a%b9%ec%88%98%ec%b2%98%eb%a6%ac" aria-label="MySQL 에서의 localhost 특수처리">MySQL 에서의 localhost 특수처리</a>
                </li>
            </ul>
        </div>
    </details>
</div>
<div class="post-content"><h2 id="-문제-상황">❕ 문제 상황<a hidden class="anchor" aria-hidden="true" href="#-문제-상황">#</a></h2>
<p>Nest.js 를 배우다가 데이터베이스를 사용할 일이 생겼다.</p>
<p>보통 나는 환경이 분리되는 걸 선호한다. 그래서 전역적으로 설치되는걸 좋아하지 않는다. <code>pip</code> 같은 것들 말이다.</p>
<p>그래서 찾아보니, <code>Docker</code> 위에 <code>MySQL</code> 컨테이너를 올려서 사용하면 환경 분리가 된다고 하더라.</p>
<img src="/assets/images/2024-10-26-network-127001-%EA%B3%BC-localhost-%EC%9D%98-%EC%B0%A8%EC%9D%B4-20241026161720760.webp" alt="2024-10-26-network-127001-과-localhost-의-차이-20241026161720760" loading="lazy" style="width: 428px;">
<p>도커와 관련해서는 <code>CLI</code> 환경에서 결국엔 다루는게 맞다고 생각했다. 그런데, 일단은 도커가 처음이기에 아직 내가 많이 몰라서 <code>Docker Desktop</code> 을 이용해서 문제를 해결하려고 한다.</p>
<h3 id="mysql-에-접속이-안되는-문제">MySQL 에 접속이 안되는 문제<a hidden class="anchor" aria-hidden="true" href="#mysql-에-접속이-안되는-문제">#</a></h3>
<pre tabindex="0"><code>mysql -u root -p&#39;root&#39; -h 172.17.0.2
mysql: [Warning] Using a password on the command line interface can be insecure.
ERROR 2003 (HY000): Can&#39;t connect to MySQL server on &#39;172.17.0.2:3306&#39; (60)
</code></pre><p>위와 같이, <code>root</code> 계정으로 직접적으로 접속하려고 했었다. 그런데, <code>mysql</code> 클라이언트 단에서 서버로 연결을 하지 못하는 상황이었다.</p>
<p><code>172.17.0.2</code> IP 는 <code>inspect</code> 해서 나온 도커 컨테이너가 할당 받은 IP 이다.</p>
<p>해당 IP로 연결을 시도해봤는데 연결되지 않는다고 떴다.</p>
<h2 id="-해결-과정">🖋️ 해결 과정<a hidden class="anchor" aria-hidden="true" href="#-해결-과정">#</a></h2>
<p>결론적으로는, 아래와 같은 명령어를 써서 해결했다.</p>
<p>첫번째로, <strong>도커의 컨테이너를 외부에서 접속하게 될 때에는 내 자신의 IP로 접속해야한다.</strong></p>
<pre tabindex="0"><code>mysql -u root -p -h localhost -P 3306
</code></pre><p>그런데, 그 과정에서 아래와 같은 에러가 떴다.</p>
<pre tabindex="0"><code>ERROR 2002 (HY000): Can&#39;t connect to local MySQL server through socket &#39;/tmp/mysql.sock&#39; (2)
</code></pre><p>한번 더 알아보니, <code>localhost</code> 대신에 <code>127.0.0.1</code> 로 호스트를 바꾸니 접속이 되었다.</p>
<h2 id="-도커와-도커-엔진을-돌리는-컴퓨터가-ip-할당을-받는-방식">🐳 도커와 도커 엔진을 돌리는 컴퓨터가 IP 할당을 받는 방식<a hidden class="anchor" aria-hidden="true" href="#-도커와-도커-엔진을-돌리는-컴퓨터가-ip-할당을-받는-방식">#</a></h2>
<p>그렇다면 왜 컨테이너 IP로 접속을 못하고, <code>localhost</code> 로 접속을 해야할까?</p>
<p>이것을 알려면 도커의 네트워크 구조를 알아야한다.</p>
<h3 id="도커-네트워크-구조">도커 네트워크 구조<a hidden class="anchor" aria-hidden="true" href="#도커-네트워크-구조">#</a></h3>
<p>도커는 기본적으로 <code>브릿지 네트워크</code> 를 사용하여 호스트 - 컨테이너 간 통신을 관리한다.</p>
<blockquote>
<p>브릿지 네트워크란?</p>
<p>브리지 네트워크는 데이터 링크 계층(Layer 2)에서 작동하는 네트워크 연결 방식 중 하나입니다.
서로 다른 네트워크 세그먼트를 하나의 논리적 네트워크로 연결하는 기술입니다.</p>
<p>세그먼트 내에서 통신을 할 때에는 노드 간 직접 통신이 가능합니다.</p>
<p>세그먼트 외부에서 통신을 할 때에는 브릿지를 통해 통신이 가능합니다.</p>
<p>이 때 중요한건 세그먼트 외부 간 통신을 직접할 수 있도록 노드 간 직접 통신이 가능하다는 점입니다.</p></blockquote>
<p>이때, 도커는 호스트 컴퓨터와 소통할 수 있도록 <code>docker0</code> 브릿지를 설치해줍니다. 해당 브릿지를 통해서 호스트 컴퓨터는 도커 컨테이너와 통신할 수 있게 된다.</p>
<img src="/assets/images/2024-10-26-network-127001-%EA%B3%BC-localhost-%EC%9D%98-%EC%B0%A8%EC%9D%B4-20241026195155071.webp" alt="2024-10-26-network-127001-과-localhost-의-차이-20241026195155071" loading="lazy">
_도커의 기본적인 네트워크 인터페이스_
<h3 id="도커가-생성한-가상-브릿지-docker0-와-커스텀-브릿지">도커가 생성한 가상 브릿지 <code>docker0</code> 와 커스텀 브릿지<a hidden class="anchor" aria-hidden="true" href="#도커가-생성한-가상-브릿지-docker0-와-커스텀-브릿지">#</a></h3>
<p>도커는 컨테이너와 호스트, 나아가서 외부 인터넷과 통신하기 위해서 <code>docker0</code> 라는 이름의 가상 브릿지를 생성한다.</p>
<p>해당 브릿지는 호스트 컴퓨터 내에서 생성 되며, 각 컨테이너는 <code>eth0</code> 라는 네트워크 인터페이스를 통해 <code>docker0</code> 브릿지와 연결된다. 이때, <code>veth*</code> 라는 이름으로 <code>docker0</code> 브릿지에서 네트워크 인터페이스로 연결된다.</p>
<p>또한, 별도의 커스텀 브릿지도 생성할 수 있다.</p>
<p>아래와 같이 <code>br-</code> 로 시작하는 경우 컨테이너에서 직접 외부로 통신하기 위한 커스텀 브릿지 다.</p>
<pre tabindex="0"><code>29: br-925c9621d01a: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    inet 172.34.0.1/16 brd 172.34.255.255 scope global br-925c9621d01a
~
162: vetha37a37a@if161: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-925c9621d01a state UP group default 
~
164: veth27db687@if163: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-925c9621d01a state UP group default 
</code></pre><h4 id="컨테이너-내부ip-로-접속할-수-없는-이유">컨테이너 내부IP 로 접속할 수 없는 이유<a hidden class="anchor" aria-hidden="true" href="#컨테이너-내부ip-로-접속할-수-없는-이유">#</a></h4>
<ul>
<li><strong>컨테이너 내부의 IP (172.17.x.x/16) 는 격리된 공간 내에 존재하기 때문</strong></li>
<li>그래서 외부에서는 <code>docker0</code> 브릿지를 통해 접근이 가능하다.</li>
</ul>
<blockquote>
<p>❔ 도커 브릿지로 직접 접속 할 수는 없나요?</p>
<p>직접 연결 시도도 가능합니다.</p>
<p>단, 아래에서 설명할 예정이지만, <code>docker0</code> 브릿지는 리눅스 환경에서만 확인 가능합니다.</p>
<img src="/assets/images/2024-10-26-network-127001-%EA%B3%BC-localhost-%EC%9D%98-%EC%B0%A8%EC%9D%B4-20241026194313111.webp" alt="2024-10-26-network-127001-과-localhost-의-차이-20241026194313111" loading="lazy"></blockquote>
<h3 id="macwindows-에서의-docker">Mac/Windows 에서의 Docker<a hidden class="anchor" aria-hidden="true" href="#macwindows-에서의-docker">#</a></h3>
<p><code>docker0</code> 라는 브릿지는 Mac/Windows 옵션에서는 존재하지 않는다. 맥과 윈도우 환경에서는 별도의 가상 리눅스 위에서 설치되기 때문이다.</p>
<p>따라서 맥, 윈도우 환경에서 접속하려면 해당 브릿지로 접속하려면 <code>172.17.0.1</code> 이 아니라 루프백 IP 를 통해서 <code>docker0</code> 인터페이스를 찾아서 접근하도록 해야한다.</p>
<h3 id="만약-이미-호스트-컴퓨터에서-포트가-열려있으면-어떻게-될까">만약 이미 호스트 컴퓨터에서 포트가 열려있으면 어떻게 될까?<a hidden class="anchor" aria-hidden="true" href="#만약-이미-호스트-컴퓨터에서-포트가-열려있으면-어떻게-될까">#</a></h3>
<p>컨테이너 <code>내부</code> 의 포트는 <code>호스트 포트와 독립적</code> 으로 작동한다!</p>
<p>&lsquo;3307:3306&rsquo; -&gt; &lsquo;host - docker0 : 3307&rsquo;  , &lsquo;veth - eth : 3306&rsquo;</p>
<p>포트를 지정할 때 <code>docker0</code> 브릿지에서 매핑을 해주기 때문에, 컨테이너에서는 어떤 포트로 열더라도, 자유롭게 열어도 상관없다.</p>
<p>앞서 말한대로 따로 임의로 지정하지 않으면, 컨테이너 내부에서만 열리게 된다. 이렇게 되면 포트를 컨테이너 외부로 열고 싶지 않을 때 유용하겠죠?</p>
<p>정리하면 아래와 같다.</p>
<ul>
<li>호스트에서 3306 포트를 사용 중이더라도 컨테이너 내부에서 3306 포트를 사용할 수 있다.</li>
<li>포트 충돌은 호스트 포트를 컨테이너 포트에 매핑할 때만 발생한다.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run -p 3307:3306 mysql
</span></span></code></pre></div><p>도커에서 실제로 실행할때, <code>3307</code> 포트와 같이 외부로 매핑될 포트를 지정해주는 작업이 일어날 때 <code>docker0</code> 브릿지 테이블에서 수정이 일어난다.</p>
<h2 id="-127001-과-localhost-의-차이">🤔 <code>127.0.0.1</code> 과 <code>localhost</code> 의 차이<a hidden class="anchor" aria-hidden="true" href="#-127001-과-localhost-의-차이">#</a></h2>
<p>그렇다면, 왜 <code>172.17.x.x</code> 포트로 연결이 안되었는지 이해가 됐을 것이다.</p>
<ul>
<li><code>172.17.x.x</code> IP는 컨테이너 내부와 도커 브릿지 사이에 연결된 연결 정보임</li>
<li>맥/윈도우 도커 환경에서는 별도의 <code>VM</code> 위에서 돌아가기 때문에 <code>172.17.0.1</code> 로 직접 접속할 수 없음</li>
</ul>
<p>하지만 그렇다고 문제가 해결되진 않았는데, <code>localhost</code> 를 통해서 접속했을 때는 접속이 되지 않았다.</p>
<p>결국 해결했던 방법은 <code>127.0.0.1</code> 로 접속을 하니 문제가 해결되었다.</p>
<img src="/assets/images/2024-10-26-network-127001-%EA%B3%BC-localhost-%EC%9D%98-%EC%B0%A8%EC%9D%B4-20241026200049342.webp" alt="2024-10-26-network-127001-과-localhost-의-차이-20241026200049342" loading="lazy" style="width: 602px;">
<blockquote>
<p>일반적으로 <code>localhost</code> 란 도메인은 존재하지 않는다.</p></blockquote>
<p>모든 네트워크 요청시, <code>DNS</code> 라는 곳에서 도메인 이름을 통해 IP 를 알아내기 때문이다. 지원되는 IP 형식이 아니면 <code>DNS</code> 를 통해 IP를 찾아서 해당 IP를 통해 연결되도록 만든다.</p>
<p>그 원인은 두가지에 있었는데, 도커의 IPv6 지원과 <code>/etc/hosts</code> 파일의 영향 때문이었다.</p>
<p><code>/etc/hosts</code> 파일을 통해 <code>localhost</code> 라는 DNS가 어떤 IP를 나타내는지 컴퓨터에 바로 알려줄 수 있도록할 수 있다. 일종의 로컬 DNS? 와 같은 느낌.</p>
<p>실제로 나와같은 경우 아래처럼 <code>IPv6</code>, <code>IPv4</code> 로컬 호스트 주소를 모두 표현하도록 연결되었는데, <code>IPv6</code> 로 연결이 시도 되어서 이런 문제가 생겼다.</p>
<img src="/assets/images/2024-10-26-network-127001-%EA%B3%BC-localhost-%EC%9D%98-%EC%B0%A8%EC%9D%B4-20241026202656011.webp" alt="2024-10-26-network-127001-과-localhost-의-차이-20241026202656011" loading="lazy">
<h3 id="도커에서-ipv6-지원-설정-활성화">도커에서 IPv6 지원 설정 활성화<a hidden class="anchor" aria-hidden="true" href="#도커에서-ipv6-지원-설정-활성화">#</a></h3>
<blockquote>
<p>도커 데스크탑 기준으로 설명</p></blockquote>
<ol>
<li>Docker Desktop 실행</li>
<li>상단 메뉴의 설정(Settings) 아이콘 클릭</li>
<li>Docker Engine 섹션으로 이동</li>
<li>설정 JSON에 위의 설정을 추가</li>
<li>Apply &amp; Restart 클릭</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;ipv6&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;fixed-cidr-v6&#34;</span><span class="p">:</span> <span class="s2">&#34;2001:db8:1::/64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;ip6tables&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><img src="/assets/images/2024-10-26-network-127001-%EA%B3%BC-localhost-%EC%9D%98-%EC%B0%A8%EC%9D%B4-20241026203002567.webp" alt="2024-10-26-network-127001-과-localhost-의-차이-20241026203002567" loading="lazy" style="width: 618px;">
<p>이후 제대로 매핑된 걸 확인하려면 아래 명령어를 실행해주자.</p>
<pre tabindex="0"><code>docker network ls
</code></pre><h2 id="mysql-에서의-localhost-특수처리">MySQL 에서의 <code>localhost</code> 특수처리<a hidden class="anchor" aria-hidden="true" href="#mysql-에서의-localhost-특수처리">#</a></h2>
<p>IPv6 옵션을 활성화 해도 제대로 해결할 수 없었는데, 그 이유는 <code>mysql</code> 만이 가지는 로컬 호스트에 대한 특수 처리 때문이었다.</p>
<p>MySQL은 localhost로 접속 시 TCP/IP가 아닌 Unix 소켓 파일을 사용한다. 따라서, 도커 컨테이너의 MySQL은 호스트와 다른 환경에서 실행되므로 소켓 파일에 접근할 수 없다.</p>
<p><strong>MySQL 에서 접속할 때는 그냥 맘놓고 127.0.0.1로 접속하자&hellip;!</strong></p>


    </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.blu3fishez.org/tags/network/">Network</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://blog.blu3fishez.org/posts/2024/2024-10-27-boj-6064-%EC%B9%B4%EC%9E%89-%EB%8B%AC%EB%A0%A5/">
    <span class="title">« Prev</span>
    <br>
    <span>[ 백준 6064 ] 카잉 달력 : C&#43;&#43; 풀이</span>
  </a>
  <a class="next" href="https://blog.blu3fishez.org/posts/2024/2024-10-25-nestjs-modules-%EB%A5%BC-%ED%86%B5%ED%95%B4-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A3%BC%EC%9E%85/">
    <span class="title">Next »</span>
    <br>
    <span>Nest.js Modules 를 통해 배우는 의존성 주입</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>© <a href="https://github.com/blu3fishez">blu3fishez</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
